<!doctype html>
<html>
  <head>
    <title>yt-dlp WebUI</title>
    <script src="webui.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }

      .section {
        margin-bottom: 10px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
    </style>
  </head>

  <body>
    <form onsubmit="handleFormSubmit(event, 'download')" id="yt-dlp_form">
      <!-- Input Url -->
      <div class="section">
        <label for="url_input">URL:</label>
        <input
          type="url"
          id="url_input"
          name="url_input"
          placeholder="https://www.bilibili.com/video/BV1hK4y1C7Uw"
          required
        />
      </div>

      <!-- Download Options -->
      <h3>Options</h3>

      <div class="section">
        <label><input type="checkbox" name="audio_only" />Audio Only</label>
      </div>

      <div class="section">
        <label for="format_select">Video Quality:</label>
        <select id="format_select" name="format">
          <option value="bestvideo+bestaudio">Best Video and Audio</option>
        </select>
      </div>

      <div class="section">
        <label for="output_path">Output Path:</label>
        <input
          type="text"
          id="output_path"
          name="output_path"
          placeholder="/path/to/output"
        />
      </div>

      <!-- Operations -->
      <h3>Actions</h3>

      <button type="submit">Download</button>

      <button type="button" onclick="handleFormSubmit(event, 'preview')">
        Preview
      </button>

      <button type="button" onclick="clearLog()">Clear Log</button>
    </form>

    <!-- Output -->
    <h3>Preview</h3>
    <textarea id="preview" rows="10" style="width: 100%" readonly></textarea>

    <h3>Log</h3>
    <textarea id="log_output" rows="10" style="width: 100%" readonly></textarea>

    <script>
      function handleFormSubmit(event, actionType) {
        event.preventDefault();

        const form = document.getElementById("yt-dlp_form");
        const formData = new FormData(form);

        const data = { action: actionType };
        formData.forEach((value, key) => {
          data[key] = value;
        });

        // Logging
        const log_output = document.getElementById("log_output");
        log_output.value += "Request: " + JSON.stringify(data, null, 2) + "\n";

        // Backend call
        webui.call("submit_url", JSON.stringify(data));
      }

      function clearLog() {
        const log_output = document.getElementById("log_output");
        log_output.value = "";
      }
    </script>
  </body>
</html>
